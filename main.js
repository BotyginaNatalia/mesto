(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n,r,o,i,u){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._templateSelector=n,this._item=e,this._userId=e.userId,this._likes=e.likes,this._callback=r,this._imageDeleteCallback=o,this._likeDeleteCallback=i,this._likeAddCallback=u,this._userLiked=this._item.likes.some((function(e){return e._id===a._userId}))}var n,r;return n=t,(r=[{key:"_getCard",value:function(){return document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0)}},{key:"createCard",value:function(){return this._element=this._getCard(),this._cardImage=this._element.querySelector(".element__image"),this._cardImage.src=this._item.link,this._element.querySelector(".element__title").textContent=this._item.name,this._cardImage.setAttribute("alt",this._item.name),this._likeButton=this._element.querySelector(".element__like-button"),this._likesNumber=this._element.querySelector(".element__number-of-like"),this._isLiked(),this._userLiked&&this._likeButton.classList.add("element__like-button_active"),this._likesNumber.textContent=this._likes.length,this._isUserOwner()||this._element.querySelector(".element__delete-button").remove(),this._setEventListeners(),this._element}},{key:"_setEventListeners",value:function(){var e=this;return this._cardImage.addEventListener("click",(function(){e._callback({name:e._item.name,link:e._item.link})})),this._likeButton.addEventListener("click",(function(){e._userLiked?e._deleteLikeCallback():e._addLikeCallback()})),this._isUserOwner()&&this._element.querySelector(".element__delete-button").addEventListener("click",(function(){e._imageDeleteCallback(e._item,e._element)})),this._element}},{key:"_isUserOwner",value:function(){if(this._item.owner._id===this._userId)return!0}},{key:"_isLiked",value:function(){var e=this;return this._userLiked=this._item.likes.some((function(t){return t._id===e._userId})),this._userLiked}},{key:"toggleLike",value:function(e){this._likeButton.classList.toggle("element__like-button_active"),this._likesNumber.textContent=e.likes.length,this._userLiked=!this._userLiked}},{key:"addLikeApi",value:function(e){this._addLikeCallback=e}},{key:"deleteLikeApi",value:function(e){this._deleteLikeCallback=e}}])&&e(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,"_showError",(function(e,t){var n=o._formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(o._validationObjects.inputErrorClass),n.classList.add(o._validationObjects.errorClass),n.textContent=t})),r(this,"_hideError",(function(e){var t=o._formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove(o._validationObjects.inputErrorClass),t.classList.remove(o._validationObjects.errorClass),t.textContent=""})),r(this,"_checkInputValidity",(function(e){e.validity.valid?o._hideError(e):o._showError(e,e.validationMessage)})),this._validationObjects=t,this._formElement=n,this._inputList=Array.from(this._formElement.querySelectorAll(this._validationObjects.inputSelector)),this._buttonElement=this._formElement.querySelector(this._validationObjects.submitButtonSelector)}var t,o;return t=e,(o=[{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(e){return!e.validity.valid}))}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._validationObjects.inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._validationObjects.inactiveButtonClass),this._buttonElement.disabled=!1)}},{key:"_setEventListeners",value:function(){var e=this;this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState(e._inputList,e._buttonElement)}))}))}},{key:"hideErrorMessage",value:function(){var e=this;this._inputList.forEach((function(t){e._hideError(t)})),this._toggleButtonState()}},{key:"enableValidation",value:function(){this._setEventListeners()}}])&&n(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"rendererItems",value:function(e){var t=this;e.forEach((function(e){return t.addItem(t.renderer(e)),e}))}},{key:"addItem",value:function(e){this._container.prepend(e)}}])&&i(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){var e=this;this._popup.addEventListener("mousedown",(function(t){(t.target===t.currentTarget||t.target.classList.contains(".element__close-button"))&&e.close()}))}}])&&a(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=p(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},f.apply(this,arguments)}function p(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function d(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function _(e){return _=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_(e)}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_(r);if(o){var n=_(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return d(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._imageCaption=t._popup.querySelector(".popup__image"),t._image=t._popup.querySelector(".popup__title_pic"),t}return t=u,(n=[{key:"open",value:function(e){this._imageCaption.textContent=e.name,this._image.src=e.link,this._image.setAttribute("alt",e.name),f(_(u.prototype),"open",this).call(this)}}])&&l(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(c);function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(){return m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=k(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},m.apply(this,arguments)}function k(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}function g(e,t){return g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},g(e,t)}function w(e,t){if(t&&("object"===b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return E(e)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},O(e)}var j=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=O(r);if(o){var n=O(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return w(this,e)});function u(e,t){var n,r,o,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),a=function(){var e=n._getInputValues();n.preloader(),n._apiCallback(e)},(o="_submitHandler")in(r=E(n=i.call(this,e)))?Object.defineProperty(r,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[o]=a,n._form=n._popup.querySelector(".popup__container"),n._inputList=n._form.querySelectorAll(".popup__info"),n._apiCallback=t,n._submit=n._form.querySelector(".popup__submit-button"),n}return t=u,(n=[{key:"_getInputValues",value:function(){var e={};return this._inputList.forEach((function(t){e[t.name]=t.value})),e}},{key:"setEventListeners",value:function(){m(O(u.prototype),"setEventListeners",this).call(this),this._popup.addEventListener("submit",this._submitHandler)}},{key:"close",value:function(){m(O(u.prototype),"close",this).call(this),this._form.reset()}},{key:"preloader",value:function(){this._submit.textContent="Сохранение..."}},{key:"offPreloader",value:function(e){this._submit.textContent=e}}])&&v(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(c);function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S=function(){function e(t){var n=t.nameSelector,r=t.aboutSelector,o=t.avatarSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._nameElement=document.querySelector(n),this._aboutElement=document.querySelector(r),this._avatarElement=document.querySelector(o)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._nameElement.textContent,about:this._aboutElement.textContent}}},{key:"setUserInfo",value:function(e){this._nameElement.textContent=e.name,this._aboutElement.textContent=e.about}},{key:"setAvatar",value:function(e){this._avatarElement.src=e}}])&&L(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(){return I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=R(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},I.apply(this,arguments)}function R(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=x(e)););return e}function q(e,t){return q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},q(e,t)}function T(e,t){if(t&&("object"===P(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&q(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=x(r);if(o){var n=x(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return T(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._submit=t._popup.querySelector(".popup__submit-button"),t}return t=u,(n=[{key:"setSubmitAction",value:function(e){this._callback=e}},{key:"setEventListeners",value:function(){I(x(u.prototype),"setEventListeners",this).call(this)}},{key:"submit",value:function(){this._submit.addEventListener("click",this._callback)}},{key:"close",value:function(){this._submit.removeEventListener("click",this._callback),I(x(u.prototype),"close",this).call(this)}},{key:"preloader",value:function(){this._submit.textContent="Удаление..."}},{key:"offPreloader",value:function(e){this._submit.textContent=e}}])&&C(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(c);function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var N=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=t.url,this._headers=t.headers,this.sendNewProfileInfo=this.sendNewProfileInfo.bind(this),this.addNewCard=this.addNewCard.bind(this),this.addLike=this.addLike.bind(this),this.deleteLike=this.deleteLike.bind(this),this.sendNewAvatar=this.sendNewAvatar.bind(this),this.deleteImage=this.deleteImage.bind(this)}var t,n;return t=e,(n=[{key:"getInfo",value:function(){return fetch("".concat(this._url,"users/me"),{method:"GET",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка")}))}},{key:"getPhotos",value:function(){return fetch("".concat(this._url,"cards"),{method:"GET",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка")}))}},{key:"sendNewProfileInfo",value:function(e){return fetch("".concat(this._url,"users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка")}))}},{key:"addNewCard",value:function(e){return fetch("".concat(this._url,"cards"),{method:"POST",headers:this._headers,body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка")}))}},{key:"addLike",value:function(e){return fetch("".concat(this._url,"cards/").concat(e._id,"/likes"),{method:"PUT",headers:this._headers,body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка")}))}},{key:"deleteLike",value:function(e){return fetch("".concat(this._url,"cards/").concat(e._id,"/likes"),{method:"DELETE",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка")}))}},{key:"deleteImage",value:function(e){return fetch("".concat(this._url,"cards/").concat(e._id),{method:"DELETE",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка")}))}},{key:"sendNewAvatar",value:function(e){return fetch("".concat(this._url,"users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.link})}).then((function(e){return e.ok?e.json():Promise.reject("Произошла ошибка")}))}}])&&B(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function D(e,t,n){return D=U()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&V(o,n.prototype),o},D.apply(null,arguments)}function U(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function V(e,t){return V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},V(e,t)}var M=document.querySelector(".profile__edit-button"),H=document.querySelector("#input-name"),J=document.querySelector("#input-job"),G=document.querySelector(".profile__add-button"),z=document.querySelector(".profile__avatar-edit-button"),F={formSelector:".popup__container",inputSelector:".popup__info",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_disabled",inputErrorClass:"popup__info_type_error",errorClass:"popup__span-error_visible"},K=document.querySelector(".popup__container_profile"),Q=document.querySelector(".popup__container_add"),W=document.querySelector(".popup__container_avatar"),X=new o(F,K),Y=new o(F,Q),Z=new o(F,W);X.enableValidation(),Y.enableValidation(),Z.enableValidation();var $,ee=new N({url:"https://nomoreparties.co/v1/cohort-41/",headers:{authorization:"fbc65fd2-5c16-4a99-9542-a08cde72dc8c","content-Type":"application/json"}});Promise.all([ee.getInfo(),ee.getPhotos()]).then((function(e){var t=e[0],n=e[1];ae.setUserInfo(t),$=t._id,n.forEach((function(e){e.userId=t._id})),te.rendererItems(n)})).catch((function(e){return console.log(e)}));var te=new u(se,".elements"),ne=new j(".popup_avatar",(function(e){ee.sendNewAvatar(e).then((function(e){ae.setAvatar(e.avatar),Z.hideErrorMessage(),ne.close()})).catch((function(e){return console.log(e)}))}));ne.setEventListeners(),z.addEventListener("click",(function(){Z.hideErrorMessage(),ne.offPreloader("Сохранить"),ne.open()}));var re=new j(".popup_edit",(function(e){ee.sendNewProfileInfo(e).then((function(e){ae.setUserInfo(e),re.close()})).catch((function(e){return console.log(e)}))}));re.setEventListeners(),M.addEventListener("click",(function(){fe(ae.getUserInfo()),X.hideErrorMessage(),fe(ae.getUserInfo()),re.offPreloader("Сохранить"),re.open()}));var oe=new j(".popup_add",(function(e){ee.addNewCard(e).then((function(e){var t=e;t.userId=$,te.addItem(se(t)),oe.close()})).catch((function(e){return console.log(e)}))}));oe.setEventListeners(),G.addEventListener("click",(function(){Y.hideErrorMessage(),oe.offPreloader("Создать"),oe.open()}));var ie=new A(".popup_delete-card");ie.setEventListeners();var ue=new y(".popup_pic");ue.setEventListeners();var ae=new S({nameSelector:".profile__title",aboutSelector:".profile__subtitle",avatarSelector:".profile__avatar"});function ce(e,t){ie.setSubmitAction((function(){ie.preloader(),ee.deleteImage(e,t).then((function(){t.remove(),t=null,ie.close()})).catch((function(e){return console.log(e)}))})),ie.offPreloader("Да"),ie.open(),ie.submit()}function se(e){var n=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return D(t,n)}(e,".template",le,ce);return n.deleteLikeApi((function(){ee.deleteLike(e).then((function(e){n.toggleLike(e)})).catch((function(e){return console.log(e)}))})),n.addLikeApi((function(){ee.addLike(e).then((function(e){n.toggleLike(e)})).catch((function(e){return console.log(e)}))})),n.createCard()}function le(e){ue.open(e)}function fe(e){H.value=e.name,J.value=e.about}})();